# Threads Backend Architecture

## System Components

```
┌───────────────────────────────────────────────────────────────────┐
│                      GraphQL API Layer                           │
│                                                                   │
│  ┌─────────────────────┐         ┌─────────────────────────┐      │
│  │                     │         │                         │      │
│  │    Apollo Server    │◄───────►│     Express Server      │      │
│  │                     │         │                         │      │
│  └─────────────────────┘         └─────────────────────────┘      │
│                                                                   │
└───────────────────────────────────┬───────────────────────────────┘
                                    │
                                    │
┌───────────────────────────────────▼───────────────────────────────┐
│                      Business Logic Layer                        │
│                                                                   │
│  ┌─────────────────────┐         ┌─────────────────────────┐      │
│  │                     │         │                         │      │
│  │  GraphQL Resolvers  │◄───────►│   Service Functions     │      │
│  │                     │         │                         │      │
│  └─────────────────────┘         └─────────────────────────┘      │
│                                                                   │
└───────────────────────────────────┬───────────────────────────────┘
                                    │
                                    │
┌───────────────────────────────────▼───────────────────────────────┐
│                       Data Access Layer                          │
│                                                                   │
│  ┌─────────────────────┐                                          │
│  │                     │                                          │
│  │     Prisma ORM      │                                          │
│  │                     │                                          │
│  └──────────┬──────────┘                                          │
│             │                                                     │
└─────────────┼─────────────────────────────────────────────────────┘
              │
              │
┌─────────────▼─────────────────────────────────────────────────────┐
│                       Database Layer                              │
│                                                                   │
│  ┌─────────────────────┐                                          │
│  │                     │                                          │
│  │     PostgreSQL      │                                          │
│  │                     │                                          │
│  └─────────────────────┘                                          │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

## Data Flow

```
┌──────────────┐    GraphQL Request     ┌──────────────┐
│              │─────────────────────►  │              │
│    Client    │                        │  API Server  │
│              │  ◄────────────────────│              │
└──────────────┘    GraphQL Response    └──────┬───────┘
                                              │
                                              │ Resolver Functions
                                              │
                                        ┌─────▼──────┐
                                        │            │
                                        │  Services  │
                                        │            │
                                        └──────┬─────┘
                                               │
                                               │ Prisma Client Calls
                                               │
                                         ┌─────▼─────┐
                                         │           │
                                         │  Prisma   │
                                         │           │
                                         └─────┬─────┘
                                               │
                                               │ SQL Queries
                                               │
                                        ┌──────▼──────┐
                                        │             │
                                        │ PostgreSQL  │
                                        │             │
                                        └─────────────┘
```

## User Authentication Flow

```
┌──────────────┐                        ┌──────────────┐
│              │  1. Login Request      │              │
│    Client    │─────────────────────►  │  API Server  │
│              │                        │              │
└──────────────┘                        └──────┬───────┘
      ▲                                        │
      │                                        │ 2. Verify Credentials
      │                                        │
      │                                  ┌─────▼──────┐
      │                                  │            │
      │                                  │  Database  │
      │                                  │            │
      │                                  └──────┬─────┘
      │                                         │
      │ 4. Return JWT Token                    │ 3. Generate JWT
      └─────────────────────────────────────────┘
```

## Thread Creation Flow

```
┌──────────────┐                        ┌──────────────┐
│              │  1. Create Thread      │              │
│    Client    │─────────────────────►  │  API Server  │
│              │                        │              │
└──────────────┘                        └──────┬───────┘
      ▲                                        │
      │                                        │ 2. Authenticate User
      │                                        │
      │                                  ┌─────▼──────┐
      │                                  │            │
      │                                  │   Auth     │
      │                                  │   Service  │
      │                                  └──────┬─────┘
      │                                         │
      │                                         │ 3. Create Thread
      │                                         │
      │                                  ┌──────▼──────┐
      │                                  │             │
      │                                  │  Thread     │
      │                                  │  Service    │
      │                                  └──────┬──────┘
      │                                         │
      │                                         │ 4. Save Thread
      │                                         │
      │                                  ┌──────▼──────┐
      │                                  │             │
      │                                  │  Database   │
      │                                  │             │
      │ 5. Return Created Thread         └─────────────┘
      └───────────────────────────────────────────────────┘
```

## Container Deployment Architecture

```
┌─────────────────────────────────────────────────────────┐
│                   Docker Compose                        │
│                                                         │
│   ┌─────────────┐         ┌────────────────────┐        │
│   │             │         │                    │        │
│   │  API Node   │◄───────►│  PostgreSQL Node   │        │
│   │             │         │                    │        │
│   └─────────────┘         └────────────────────┘        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```
